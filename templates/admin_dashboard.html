<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | User Management | AarogyaMitra</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== COMPLETE CSS - EXACT SAME AS DONOR/RECEIVER DASHBOARD ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #ff7a00;
            --primary-dark: #e36c00;
            --secondary: #2c7fb8;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --purple: #6f42c1;
            --purple-dark: #5a32a3;
            --info: #17a2b8;
            --dark-blue: #1e3c72;
            --donation-gradient: linear-gradient(135deg, #ff7a00, #ff9f4b);
            --request-gradient: linear-gradient(135deg, #17a2b8, #6ab0e6);
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ===== NAVBAR STYLES - IDENTICAL TO DONOR/RECEIVER ===== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 2rem;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .logo-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .menu {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 1.5rem;
        }

        .menu li a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .menu li a:hover {
            color: var(--primary);
        }

        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid var(--light-gray);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .profile-icon i {
            font-size: 20px;
        }

        .profile-icon.has-image {
            background: none;
            color: inherit;
        }

        .profile-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .dropdown-menu {
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 200px;
            padding: 10px 0;
            display: none;
            z-index: 101;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-header {
            padding: 12px 20px;
            font-weight: 600;
            border-bottom: 1px solid var(--light-gray);
            color: var(--dark);
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--dark);
            transition: background-color 0.3s;
        }

        .dropdown-menu a:hover {
            background-color: var(--light);
        }

        .logout-link {
            color: var(--danger) !important;
            border-top: 1px solid var(--light-gray);
            margin-top: 5px;
            padding-top: 12px;
        }

        /* Context Menu for Profile Image */
        .context-menu {
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            width: 180px;
            padding: 8px 0;
            z-index: 1000;
            display: none;
            border: 1px solid var(--light-gray);
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
            color: var(--dark);
        }

        .context-menu-item:hover {
            background-color: rgba(111,66,193,0.08);
            color: var(--purple);
        }

        .context-menu-item i {
            width: 18px;
            text-align: center;
            color: var(--purple);
        }

        .context-menu-item.danger {
            color: var(--danger);
        }

        .context-menu-item.danger i {
            color: var(--danger);
        }

        .context-menu-item.danger:hover {
            background-color: rgba(220,53,69,0.08);
        }

        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            padding-top: 70px;
        }

        /* Sidebar - Admin Specific */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #fff 0%, #f8f9fa 100%);
            padding: 30px 20px;
            box-shadow: 2px 0 12px rgba(0,0,0,0.08);
            border-radius: 0 12px 12px 0;
            position: fixed;
            height: calc(100vh - 70px);
            overflow-y: hidden;
            border-right: 1px solid rgba(255,122,0,0.1);
        }

        .sidebar:hover {
            overflow-y: auto;
        }

        /* Hide scrollbar */
        .sidebar::-webkit-scrollbar {
            display: none;
        }

        .sidebar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .user-profile {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,122,0,0.1);
            margin-bottom: 25px;
        }

        .user-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #fff;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102,126,234,0.3);
            cursor: pointer;
            object-fit: cover;
        }

        .user-avatar i {
            font-size: 40px;
        }

        .user-avatar.has-image {
            background: none;
            padding: 0;
        }

        .user-avatar.has-image img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-avatar:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 12px 25px rgba(102,126,234,0.4);
        }

        .user-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .user-role {
            font-size: 14px;
            color: #fff;
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            display: inline-block;
            padding: 6px 18px;
            border-radius: 30px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(111,66,193,0.2);
            transition: all 0.3s ease;
        }

        .user-role:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(111,66,193,0.3);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 8px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 18px;
            text-decoration: none;
            color: var(--dark);
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
            cursor: pointer;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: linear-gradient(135deg, rgba(111,66,193,0.08) 0%, rgba(111,66,193,0.12) 100%);
            color: var(--purple);
            border-left: 3px solid var(--purple);
            transform: translateX(5px);
        }

        .sidebar-menu i {
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        .sidebar-menu a:hover i {
            transform: scale(1.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 35px 35px;
            margin-left: 280px;
            width: calc(100% - 280px);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: #fff;
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.04);
        }

        .dashboard-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            position: relative;
            background: linear-gradient(135deg, var(--purple) 0%, var(--dark-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(111,66,193,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(111,66,193,0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--purple);
            color: var(--purple);
        }

        .btn-outline:hover {
            background: var(--purple);
            color: #fff;
            transform: translateY(-2px);
        }

        /* Stats Cards - Admin Metrics */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .stat-card:nth-child(1):hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 35px rgba(111,66,193,0.25);
            background: linear-gradient(135deg, #fff 0%, #f3e8ff 100%);
            border-color: var(--purple);
        }

        .stat-card:nth-child(2):hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 35px rgba(40,167,69,0.25);
            background: linear-gradient(135deg, #fff 0%, #e8f5e9 100%);
            border-color: var(--success);
        }

        .stat-card:nth-child(3):hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 35px rgba(255,122,0,0.25);
            background: linear-gradient(135deg, #fff 0%, #fff3e0 100%);
            border-color: var(--primary);
        }

        .stat-card:nth-child(4):hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 35px rgba(23,162,184,0.25);
            background: linear-gradient(135deg, #fff 0%, #e3f2fd 100%);
            border-color: var(--info);
        }

        .stat-icon {
            width: 65px;
            height: 65px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
        }

        .stat-icon.purple { 
            background: linear-gradient(135deg, #6f42c1, #8a63d2);
        }
        .stat-icon.green { 
            background: linear-gradient(135deg, #28a745, #5cd67c);
        }
        .stat-icon.orange { 
            background: linear-gradient(135deg, #ff7a00, #ff9f4b);
        }
        .stat-icon.blue { 
            background: linear-gradient(135deg, #17a2b8, #6ab0e6);
        }

        .stat-info h3 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-info h3 {
            transform: scale(1.1);
        }

        .stat-info p {
            font-size: 14px;
            color: var(--gray);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-info p {
            color: var(--dark);
            font-weight: 600;
        }

        /* ===== DONATIONS & REQUESTS DETAILED SECTIONS ===== */
        .detailed-section {
            background: #fff;
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
            margin-bottom: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .detailed-section:hover {
            box-shadow: 0 15px 40px rgba(111,66,193,0.15);
            border-color: var(--purple);
        }

        .section-header-large {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .section-header-large h2 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header-large h2 i {
            font-size: 28px;
        }

        .section-header-large .donations-title {
            color: var(--primary);
        }

        .section-header-large .requests-title {
            color: var(--info);
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(255,122,0,0.05) 0%, rgba(255,122,0,0.1) 100%);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255,122,0,0.2);
        }

        .stat-item.requests-bg {
            background: linear-gradient(135deg, rgba(23,162,184,0.05) 0%, rgba(23,162,184,0.1) 100%);
        }

        .stat-item.requests-bg:hover {
            box-shadow: 0 10px 25px rgba(23,162,184,0.2);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            font-weight: 500;
        }

        .detailed-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .info-card {
            background: #f8f9fa;
            border-radius: 18px;
            padding: 25px;
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-color: transparent;
        }

        .info-card.donations-card:hover {
            background: linear-gradient(135deg, #fff3e0, #fff);
        }

        .info-card.requests-card:hover {
            background: linear-gradient(135deg, #e3f2fd, #fff);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
        }

        .info-icon.donations-icon {
            background: var(--donation-gradient);
        }

        .info-icon.requests-icon {
            background: var(--request-gradient);
        }

        .info-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .info-desc {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Medicine List Styles */
        .medicine-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .medicine-list::-webkit-scrollbar {
            width: 6px;
        }

        .medicine-list::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }

        .medicine-list::-webkit-scrollbar-thumb {
            background: var(--purple);
            border-radius: 10px;
        }

        .medicine-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .medicine-item:hover {
            transform: translateX(5px);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(255,122,0,0.1);
        }

        .medicine-item.donations-item:hover {
            border-color: var(--primary);
        }

        .medicine-item.requests-item:hover {
            border-color: var(--info);
        }

        .medicine-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .medicine-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
        }

        .medicine-meta {
            font-size: 12px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .medicine-meta i {
            font-size: 12px;
            margin-right: 3px;
        }

        .medicine-quantity {
            font-weight: 700;
            font-size: 18px;
        }

        .donations-quantity {
            color: var(--primary);
        }

        .requests-quantity {
            color: var(--info);
        }

        .badge-stat {
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
        }

        .badge-stat.available {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .badge-stat.pending {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            color: #856404;
        }

        .badge-stat.completed {
            background: linear-gradient(135deg, #cce5ff, #b8daff);
            color: #004085;
        }

        .badge-stat.claimed {
            background: linear-gradient(135deg, #e2e3e5, #d6d8d9);
            color: #383d41;
        }

        .badge-stat.urgent {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        /* Quick Stats Row */
        .quick-stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .quick-stat-card {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }

        .quick-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(111,66,193,0.15);
        }

        .quick-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 22px;
        }

        .quick-stat-info h4 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.2;
        }

        .quick-stat-info p {
            font-size: 13px;
            color: var(--gray);
            font-weight: 500;
        }

        /* Admin Responsibilities Grid - 2x2 Square Boxes */
        .responsibilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .responsibility-card {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
            border: 1px solid rgba(111,66,193,0.1);
            text-align: center;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .responsibility-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(111,66,193,0.15);
            border-color: var(--purple);
        }

        .responsibility-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(111,66,193,0.1) 0%, rgba(111,66,193,0.15) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: var(--purple);
            font-size: 30px;
            transition: all 0.3s ease;
        }

        .responsibility-card:hover .responsibility-icon {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            color: white;
            transform: scale(1.1) rotate(5deg);
        }

        .responsibility-card h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--dark);
        }

        .responsibility-card p {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .responsibility-stats {
            display: flex;
            justify-content: space-around;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .responsibility-stat {
            text-align: center;
        }

        .responsibility-stat span {
            display: block;
            font-size: 20px;
            font-weight: 700;
            color: var(--purple);
        }

        .responsibility-stat small {
            font-size: 12px;
            color: var(--gray);
        }

        /* Users Table */
        .users-table-section {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-header h3 i {
            color: var(--purple);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th {
            text-align: left;
            padding: 15px;
            background: linear-gradient(135deg, rgba(111,66,193,0.05) 0%, rgba(111,66,193,0.08) 100%);
            color: var(--purple-dark);
            font-weight: 600;
            font-size: 14px;
        }

        .users-table td {
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
            font-size: 14px;
            vertical-align: middle;
        }

        .users-table tr:hover td {
            background-color: rgba(111,66,193,0.02);
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar-table {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info-table {
            display: flex;
            flex-direction: column;
        }

        .user-name-table {
            font-weight: 600;
            color: var(--dark);
        }

        .user-email-table {
            font-size: 12px;
            color: var(--gray);
        }

        .role-badge {
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .role-badge.admin {
            background: linear-gradient(135deg, #6f42c1, #8a63d2);
            color: white;
        }

        .role-badge.donor {
            background: linear-gradient(135deg, #ff7a00, #ff9f4b);
            color: white;
        }

        .role-badge.receiver {
            background: linear-gradient(135deg, #17a2b8, #6ab0e6);
            color: white;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-badge.active {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .status-badge.pending {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            color: #856404;
        }

        .status-badge.suspended {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 14px;
        }

        .icon-btn.view {
            background: linear-gradient(135deg, #17a2b8, #6ab0e6);
        }

        .icon-btn.edit {
            background: linear-gradient(135deg, #ff7a00, #ff9f4b);
        }

        .icon-btn.verify {
            background: linear-gradient(135deg, #28a745, #5cd67c);
        }

        .icon-btn.suspend {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
        }

        .icon-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--light-gray);
            background: #fff;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover,
        .pagination-btn.active {
            background: var(--purple);
            border-color: var(--purple);
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .quick-action-item {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, rgba(111,66,193,0.03) 0%, rgba(111,66,193,0.06) 100%);
            border-radius: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quick-action-item:hover {
            transform: translateY(-5px);
            background: linear-gradient(135deg, rgba(111,66,193,0.08) 0%, rgba(111,66,193,0.12) 100%);
            box-shadow: 0 10px 25px rgba(111,66,193,0.2);
        }

        .quick-action-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 26px;
            transition: all 0.3s ease;
        }

        .quick-action-item:hover .quick-action-icon {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(111,66,193,0.3);
        }

        .quick-action-item h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .quick-action-item p {
            font-size: 13px;
            color: var(--gray);
        }

        /* Medicine Requests Page Styles */
        .requests-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .request-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .request-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(111,66,193,0.15);
            border-color: var(--purple);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .request-medicine {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }

        .request-status {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .request-status.pending {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            color: #856404;
        }

        .request-details {
            margin: 15px 0;
            padding: 15px 0;
            border-top: 1px solid var(--light-gray);
            border-bottom: 1px solid var(--light-gray);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .detail-label {
            color: var(--gray);
        }

        .detail-value {
            font-weight: 600;
            color: var(--dark);
        }

        /* Donations Page Styles */
        .donations-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .donation-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .donation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(111,66,193,0.15);
            border-color: var(--purple);
        }

        .donation-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .donor-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff7a00, #ff9f4b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .donor-info h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark);
        }

        .donor-info p {
            font-size: 12px;
            color: var(--gray);
        }

        /* Verification Page Styles */
        .verification-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 15px;
        }

        .tab-btn {
            padding: 10px 25px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 30px;
        }

        .tab-btn:hover,
        .tab-btn.active {
            background: linear-gradient(135deg, rgba(111,66,193,0.08) 0%, rgba(111,66,193,0.12) 100%);
            color: var(--purple);
        }

        .verification-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .verification-item:hover {
            border-color: var(--purple);
            box-shadow: 0 8px 20px rgba(111,66,193,0.1);
        }

        /* Reports Page Styles */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .report-card {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(111,66,193,0.15);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .report-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .report-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(111,66,193,0.1) 0%, rgba(111,66,193,0.15) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--purple);
            font-size: 22px;
        }

        /* Settings Page Styles */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .settings-card {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.04);
        }

        .settings-card h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            width: 50px;
            height: 24px;
            background: var(--light-gray);
            border-radius: 30px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--purple);
        }

        .toggle-slider {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            left: 28px;
        }

        /* Hide/Show Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* File Upload Input - Hidden */
        #profileImageUpload {
            display: none;
        }

        /* Responsive */
        @media(max-width: 1200px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            .detailed-grid {
                grid-template-columns: 1fr;
            }
            .quick-stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            .responsibilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }
            .requests-grid,
            .donations-grid,
            .reports-grid,
            .settings-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media(max-width: 992px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            .dashboard-container {
                flex-direction: column;
            }
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            .user-filters {
                flex-direction: column;
                align-items: flex-start;
            }
            .search-box {
                width: 100%;
            }
            .filter-group {
                width: 100%;
            }
            .filter-select {
                flex: 1;
            }
            .requests-grid,
            .donations-grid,
            .reports-grid,
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media(max-width: 768px) {
            .main-content {
                padding: 25px 20px;
            }
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .navbar {
                padding: 0.5rem 1rem;
            }
            .menu {
                gap: 0.8rem;
            }
            .logo-text {
                font-size: 1.1rem;
            }
            .stats-cards {
                grid-template-columns: 1fr;
            }
            .quick-stats-row {
                grid-template-columns: 1fr;
            }
            .stats-overview {
                grid-template-columns: 1fr;
            }
            .quick-actions {
                grid-template-columns: 1fr;
            }
            .responsibilities-grid {
                grid-template-columns: 1fr;
            }
        }

        @media(max-width: 576px) {
            .menu li:not(:last-child) {
                display: none;
            }
            .btn {
                padding: 10px 20px;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-section, .stat-card, .detailed-section, .info-card {
            animation: slideIn 0.5s ease;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--purple-dark);
        }
    </style>
</head>
<body>

    <!-- Hidden File Input for Profile Image Upload -->
    <input type="file" id="profileImageUpload" accept="image/*">

    <!-- Context Menu for Profile Image -->
    <div class="context-menu" id="profileContextMenu">
        <div class="context-menu-item" id="uploadImageOption">
            <i class="fas fa-upload"></i>
            <span>Upload Image</span>
        </div>
        <div class="context-menu-item" id="removeImageOption">
            <i class="fas fa-trash"></i>
            <span>Remove Image</span>
        </div>
        <div class="context-menu-item" id="viewImageOption">
            <i class="fas fa-eye"></i>
            <span>View Image</span>
        </div>
    </div>

    <!-- NAVBAR - EXACT SAME AS DONOR/RECEIVER -->
    <nav class="navbar">
        <div class="logo">
            <img src="/static/img/logo.png" alt="AarogyaMitra Logo" onerror="this.src='https://via.placeholder.com/40x40?text=A'; this.onerror=null;">
            <span class="logo-text">AarogyaMitra</span>
        </div>

        <ul class="menu">
            <li><a href="/">Home</a></li>
            <li><a href="/#about">About</a></li>
            <li><a href="/#medicines">Available Medicines</a></li>
            <li><a href="/#contact">Contact</a></li>

            <!-- Admin Profile Dropdown - Default Admin Icon -->
            <li style="position: relative;">
                <div class="profile-icon" id="navbarProfileIcon" onclick="toggleDropdown()" oncontextmenu="showContextMenu(event, 'navbar')">
                    {% if user and user.profile_image %}
                        <img src="/static/profile_images/{{ user.profile_image }}" alt="Profile" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">
                    {% else %}
                        <i class="fas fa-user-shield"></i>
                    {% endif %}
                </div>

                <div class="dropdown-menu" id="profileMenu">
                    <div class="dropdown-header" id="dropdown-username">{{ user.username }}</div>
                    <a href="#" onclick="navigateTo('dashboard')">Dashboard</a>
                    <a href="#" onclick="navigateTo('user-management')">User Management</a>
                    <a href="#" onclick="navigateTo('settings')">Settings</a>
                    <a href="/logout" class="logout-link">Logout</a>
                </div>
            </li>
        </ul>
    </nav>

    <!-- DASHBOARD CONTAINER -->
    <div class="dashboard-container">
        <!-- SIDEBAR - Admin Specific -->
        <div class="sidebar">
            <div class="user-profile">
                <div class="user-avatar" id="sidebarAvatar" oncontextmenu="showContextMenu(event, 'sidebar')">
                    {% if user and user.profile_image %}
                        <img src="/static/profile_images/{{ user.profile_image }}" alt="Profile" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">
                    {% else %}
                        <i class="fas fa-user-shield"></i>
                    {% endif %}
                </div>
                <h3 class="user-name" id="sidebar-username">{{ user.username }}</h3>
                <span class="user-role">Super Admin</span>
            </div>
            
            <ul class="sidebar-menu">
                <li><a onclick="navigateTo('dashboard')" id="sidebar-dashboard" class="active"><i class="fas fa-chart-pie"></i> Dashboard</a></li>
                <li><a onclick="navigateTo('user-management')" id="sidebar-user-management"><i class="fas fa-users"></i> User Management</a></li>
                <li><a onclick="navigateTo('medicine-requests')" id="sidebar-medicine-requests"><i class="fas fa-prescription"></i> Medicine Requests</a></li>
                <li><a onclick="navigateTo('donations')" id="sidebar-donations"><i class="fas fa-donate"></i> Donations</a></li>
                <li><a onclick="navigateTo('verification')" id="sidebar-verification"><i class="fas fa-check-circle"></i> Verification</a></li>
                <li><a onclick="navigateTo('reports')" id="sidebar-reports"><i class="fas fa-flag"></i> Reports</a></li>
                <li><a onclick="navigateTo('settings')" id="sidebar-settings"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- Dashboard Home Page -->
            <div id="page-dashboard" class="page active">
                <div class="dashboard-header">
                    <h2>Admin Dashboard</h2>
                    <div class="header-date" id="current-datetime"></div>
                </div>

                <!-- QUICK STATS ROW -->
                <div class="quick-stats-row">
                    <div class="quick-stat-card">
                        <div class="quick-stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="quick-stat-info">
                            <h4 id="total-users-quick">0</h4>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="quick-stat-card">
                        <div class="quick-stat-icon">
                            <i class="fas fa-donate"></i>
                        </div>
                        <div class="quick-stat-info">
                            <h4 id="total-donations-quick">0</h4>
                            <p>Total Donations</p>
                        </div>
                    </div>
                    <div class="quick-stat-card">
                        <div class="quick-stat-icon">
                            <i class="fas fa-prescription"></i>
                        </div>
                        <div class="quick-stat-info">
                            <h4 id="total-requests-quick">0</h4>
                            <p>Total Requests</p>
                        </div>
                    </div>
                    <div class="quick-stat-card">
                        <div class="quick-stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="quick-stat-info">
                            <h4 id="completed-transactions">0</h4>
                            <p>Completed</p>
                        </div>
                    </div>
                </div>

                <!-- STATS CARDS -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-users">0</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="active-users">0</h3>
                            <p>Active Users</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pending-items">0</h3>
                            <p>Pending Items</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="completed-items">0</h3>
                            <p>Completed</p>
                        </div>
                    </div>
                </div>

                <!-- DETAILED DONATIONS SECTION -->
                <div class="detailed-section">
                    <div class="section-header-large">
                        <h2 class="donations-title">
                            <i class="fas fa-donate" style="color: var(--primary);"></i>
                            Medicine Donations - Complete Overview
                        </h2>
                        <a onclick="navigateTo('donations')" class="view-all">
                            View All Donations <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>

                    <!-- Donations Stats Overview -->
                    <div class="stats-overview">
                        <div class="stat-item">
                            <div class="stat-value" id="total-donations">0</div>
                            <div class="stat-label">Total Donations</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="available-donations">0</div>
                            <div class="stat-label">Available</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="claimed-donations">0</div>
                            <div class="stat-label">Claimed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="completed-donations">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                    </div>

                    <!-- Detailed Donations Info Grid -->
                    <div class="detailed-grid">
                        <!-- Left Column - Donation Summary -->
                        <div class="info-card donations-card">
                            <div class="info-header">
                                <div class="info-icon donations-icon">
                                    <i class="fas fa-box-open"></i>
                                </div>
                                <div>
                                    <div class="info-title">Donation Summary</div>
                                    <div class="info-desc">Overview of all medicine donations</div>
                                </div>
                            </div>
                            <div class="info-stats">
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Total Medicine Items</span>
                                    <span class="info-stat-value donations-value" id="total-donation-items">0</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Total Quantity Donated</span>
                                    <span class="info-stat-value donations-value" id="total-quantity-donated">0 units</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Unique Donors</span>
                                    <span class="info-stat-value donations-value" id="unique-donors">0</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Categories of Medicines</span>
                                    <span class="info-stat-value donations-value" id="medicine-categories">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Medicine List with Quantities -->
                        <div class="info-card donations-card">
                            <div class="info-header">
                                <div class="info-icon donations-icon">
                                    <i class="fas fa-list-ul"></i>
                                </div>
                                <div>
                                    <div class="info-title">Medicines Donated</div>
                                    <div class="info-desc">List of all medicines with quantities</div>
                                </div>
                            </div>
                            <div class="medicine-list" id="donations-medicine-list">
                                <!-- Medicines will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Expiry Summary -->
                    <div style="margin-top: 25px; padding: 20px; background: rgba(255,122,0,0.05); border-radius: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="font-weight: 600; color: var(--dark);"><i class="fas fa-calendar-alt" style="color: var(--primary); margin-right: 8px;"></i>Expiry Summary</span>
                            </div>
                            <div style="display: flex; gap: 30px;">
                                <div><span style="color: var(--danger); font-weight: 700;" id="expired-count">0</span> <span style="color: var(--gray);">Expired</span></div>
                                <div><span style="color: var(--warning); font-weight: 700;" id="expiring-soon-count">0</span> <span style="color: var(--gray);">Expiring Soon (30 days)</span></div>
                                <div><span style="color: var(--success); font-weight: 700;" id="safe-count">0</span> <span style="color: var(--gray);">Safe (>90 days)</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DETAILED REQUESTS SECTION -->
                <div class="detailed-section">
                    <div class="section-header-large">
                        <h2 class="requests-title">
                            <i class="fas fa-prescription" style="color: var(--info);"></i>
                            Medicine Requests - Complete Overview
                        </h2>
                        <a onclick="navigateTo('medicine-requests')" class="view-all">
                            View All Requests <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>

                    <!-- Requests Stats Overview -->
                    <div class="stats-overview">
                        <div class="stat-item requests-bg">
                            <div class="stat-value" id="total-requests">0</div>
                            <div class="stat-label">Total Requests</div>
                        </div>
                        <div class="stat-item requests-bg">
                            <div class="stat-value" id="pending-requests-total">0</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-item requests-bg">
                            <div class="stat-value" id="approved-requests-total">0</div>
                            <div class="stat-label">Approved</div>
                        </div>
                        <div class="stat-item requests-bg">
                            <div class="stat-value" id="completed-requests-total">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                    </div>

                    <!-- Detailed Requests Info Grid -->
                    <div class="detailed-grid">
                        <!-- Left Column - Request Summary -->
                        <div class="info-card requests-card">
                            <div class="info-header">
                                <div class="info-icon requests-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <div>
                                    <div class="info-title">Request Summary</div>
                                    <div class="info-desc">Overview of all medicine requests</div>
                                </div>
                            </div>
                            <div class="info-stats">
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Total Requests Made</span>
                                    <span class="info-stat-value requests-value" id="total-requests-count">0</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Total Quantity Requested</span>
                                    <span class="info-stat-value requests-value" id="total-quantity-requested">0 units</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Unique Receivers</span>
                                    <span class="info-stat-value requests-value" id="unique-receivers">0</span>
                                </div>
                                <div class="info-stat-row">
                                    <span class="info-stat-label">Fulfillment Rate</span>
                                    <span class="info-stat-value requests-value" id="fulfillment-rate">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Requested Medicines List -->
                        <div class="info-card requests-card">
                            <div class="info-header">
                                <div class="info-icon requests-icon">
                                    <i class="fas fa-list-ul"></i>
                                </div>
                                <div>
                                    <div class="info-title">Requested Medicines</div>
                                    <div class="info-desc">List of all requested medicines with quantities</div>
                                </div>
                            </div>
                            <div class="medicine-list" id="requests-medicine-list">
                                <!-- Requested medicines will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Urgency Breakdown -->
                    <div style="margin-top: 25px; padding: 20px; background: rgba(23,162,184,0.05); border-radius: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <span style="font-weight: 600; color: var(--dark);"><i class="fas fa-exclamation-triangle" style="color: var(--info); margin-right: 8px;"></i>Urgency Breakdown</span>
                            </div>
                            <div style="display: flex; gap: 25px; flex-wrap: wrap;">
                                <div><span style="color: var(--danger); font-weight: 700;" id="immediate-count">0</span> <span style="color: var(--gray);">Immediate</span></div>
                                <div><span style="color: var(--warning); font-weight: 700;" id="urgent-count">0</span> <span style="color: var(--gray);">Urgent</span></div>
                                <div><span style="color: var(--info); font-weight: 700;" id="normal-count">0</span> <span style="color: var(--gray);">Normal</span></div>
                                <div><span style="color: var(--success); font-weight: 700;" id="low-count">0</span> <span style="color: var(--gray);">Low</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Responsibilities Grid - 2x2 Square Boxes -->
                <div class="responsibilities-grid">
                    <div class="responsibility-card">
                        <div class="responsibility-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h4>Verify Users</h4>
                        <p>Review and verify new user registrations, prescriptions, and donor credentials.</p>
                        <div class="responsibility-stats">
                            <div class="responsibility-stat">
                                <span id="pending-verifications">0</span>
                                <small>Pending</small>
                            </div>
                            <div class="responsibility-stat">
                                <span id="today-registrations">0</span>
                                <small>Today</small>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="navigateTo('verification')">
                            <i class="fas fa-check-circle"></i> Verify Now
                        </button>
                    </div>

                    <div class="responsibility-card">
                        <div class="responsibility-icon">
                            <i class="fas fa-user-cog"></i>
                        </div>
                        <h4>Manage Roles</h4>
                        <p>Assign and modify user roles based on verification status.</p>
                        <div class="responsibility-stats">
                            <div class="responsibility-stat">
                                <span id="total-donors">0</span>
                                <small>Donors</small>
                            </div>
                            <div class="responsibility-stat">
                                <span id="total-receivers">0</span>
                                <small>Receivers</small>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="navigateTo('user-management')">
                            <i class="fas fa-edit"></i> Manage Roles
                        </button>
                    </div>

                    <div class="responsibility-card">
                        <div class="responsibility-icon">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <h4>Suspend/Block</h4>
                        <p>Temporarily suspend or permanently block users violating platform policies.</p>
                        <div class="responsibility-stats">
                            <div class="responsibility-stat">
                                <span id="suspended-users">0</span>
                                <small>Suspended</small>
                            </div>
                            <div class="responsibility-stat">
                                <span id="blocked-users">0</span>
                                <small>Blocked</small>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="navigateTo('user-management')">
                            <i class="fas fa-ban"></i> Review Reports
                        </button>
                    </div>

                    <div class="responsibility-card">
                        <div class="responsibility-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h4>Platform Activity</h4>
                        <p>View complete platform activity, donations, requests, and compliance records.</p>
                        <div class="responsibility-stats">
                            <div class="responsibility-stat">
                                <span id="total-transactions">0</span>
                                <small>Transactions</small>
                            </div>
                            <div class="responsibility-stat">
                                <span id="active-today">0</span>
                                <small>Active Today</small>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="navigateTo('reports')">
                            <i class="fas fa-history"></i> View Reports
                        </button>
                    </div>
                </div>

                <!-- QUICK ACTIONS -->
                <div class="dashboard-section full-width">
                    <div class="section-header">
                        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="quick-action-item" onclick="navigateTo('user-management')">
                            <div class="quick-action-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h4>Manage Users</h4>
                            <p id="quick-users-count">0 users registered</p>
                        </div>
                        <div class="quick-action-item" onclick="navigateTo('medicine-requests')">
                            <div class="quick-action-icon">
                                <i class="fas fa-prescription"></i>
                            </div>
                            <h4>Pending Requests</h4>
                            <p id="quick-requests-count">0 requests need review</p>
                        </div>
                        <div class="quick-action-item" onclick="navigateTo('verification')">
                            <div class="quick-action-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h4>Verifications</h4>
                            <p id="quick-verifications-count">0 pending verifications</p>
                        </div>
                        <div class="quick-action-item" onclick="securityCheck()">
                            <div class="quick-action-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h4>Security Check</h4>
                            <p>System security scan</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- USER MANAGEMENT PAGE -->
            <div id="page-user-management" class="page">
                <div class="dashboard-header">
                    <h2>User Management</h2>
                </div>

                <!-- User Filters -->
                <div class="user-filters">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search users by name, email, or ID..." id="userSearch">
                    </div>
                    <div class="filter-group">
                        <select class="filter-select" id="roleFilter">
                            <option value="all">All Roles</option>
                            <option value="donor">Donors</option>
                            <option value="receiver">Receivers</option>
                            <option value="admin">Admins</option>
                        </select>
                        <select class="filter-select" id="statusFilter">
                            <option value="all">All Status</option>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="users-table-section">
                    <div class="table-header">
                        <h3><i class="fas fa-users"></i> Registered Users (<span id="total-users-count">0</span>)</h3>
                    </div>

                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Role</th>
                                <th>Joined</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be loaded dynamically -->
                        </tbody>
                    </table>

                    <!-- Pagination -->
                    <div class="pagination">
                        <button class="pagination-btn" id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                        <button class="pagination-btn active" id="page-1">1</button>
                        <button class="pagination-btn" id="page-2">2</button>
                        <button class="pagination-btn" id="page-3">3</button>
                        <button class="pagination-btn" id="next-page"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- MEDICINE REQUESTS PAGE -->
            <div id="page-medicine-requests" class="page">
                <div class="dashboard-header">
                    <h2>Medicine Requests</h2>
                    <div class="header-actions">
                        <select class="filter-select" id="request-status-filter" style="width: 150px;">
                            <option value="all">All Requests</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <div class="requests-grid" id="requests-grid">
                    <!-- Request cards will be loaded dynamically -->
                </div>

                <div class="users-table-section">
                    <div class="table-header">
                        <h3><i class="fas fa-list"></i> All Medicine Requests</h3>
                    </div>
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Medicine</th>
                                <th>Requester</th>
                                <th>Quantity</th>
                                <th>Location</th>
                                <th>Urgency</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requests-table-body">
                            <!-- Requests will be loaded dynamically -->
                        </tbody>
                    </table>
                    
                    <div class="pagination">
                        <button class="pagination-btn" id="requests-prev" disabled><i class="fas fa-chevron-left"></i></button>
                        <button class="pagination-btn active">1</button>
                        <button class="pagination-btn">2</button>
                        <button class="pagination-btn">3</button>
                        <button class="pagination-btn" id="requests-next"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- DONATIONS PAGE -->
            <div id="page-donations" class="page">
                <div class="dashboard-header">
                    <h2>Donations</h2>
                    <div class="header-actions">
                        <select class="filter-select" id="donation-status-filter" style="width: 150px;">
                            <option value="all">All Donations</option>
                            <option value="available">Available</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <div class="donations-grid" id="donations-grid">
                    <!-- Donation cards will be loaded dynamically -->
                </div>
            </div>

            <!-- VERIFICATION PAGE -->
            <div id="page-verification" class="page">
                <div class="dashboard-header">
                    <h2>Verification</h2>
                </div>

                <div class="verification-tabs">
                    <button class="tab-btn active" onclick="filterVerifications('user')">User Verification</button>
                    <button class="tab-btn" onclick="filterVerifications('prescription')">Prescription Verification</button>
                    <button class="tab-btn" onclick="filterVerifications('donor')">Donor Verification</button>
                </div>

                <div id="verification-list">
                    <!-- Verification items will be loaded dynamically -->
                </div>
            </div>

            <!-- REPORTS PAGE -->
            <div id="page-reports" class="page">
                <div class="dashboard-header">
                    <h2>Reports & Analytics</h2>
                </div>

                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-header">
                            <span class="report-title">User Reports</span>
                            <div class="report-icon">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <p style="color: var(--gray); margin-bottom: 20px;">View detailed reports on user registrations, activity, and demographics.</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="generateReport('users')">
                                <i class="fas fa-file-pdf"></i> Generate
                            </button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-header">
                            <span class="report-title">Donation Reports</span>
                            <div class="report-icon">
                                <i class="fas fa-donate"></i>
                            </div>
                        </div>
                        <p style="color: var(--gray); margin-bottom: 20px;">Track medicine donations, availability, and distribution metrics.</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="generateReport('donations')">
                                <i class="fas fa-file-pdf"></i> Generate
                            </button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-header">
                            <span class="report-title">Request Reports</span>
                            <div class="report-icon">
                                <i class="fas fa-prescription"></i>
                            </div>
                        </div>
                        <p style="color: var(--gray); margin-bottom: 20px;">Analyze medicine requests, fulfillment rates, and urgency patterns.</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="generateReport('requests')">
                                <i class="fas fa-file-pdf"></i> Generate
                            </button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-header">
                            <span class="report-title">Verification Reports</span>
                            <div class="report-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <p style="color: var(--gray); margin-bottom: 20px;">Monitor verification queues, processing times, and approval rates.</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="generateReport('verification')">
                                <i class="fas fa-file-pdf"></i> Generate
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div id="page-settings" class="page">
                <div class="dashboard-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
                        <div class="settings-item">
                            <span>Two-Factor Authentication</span>
                            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span>Session Timeout (minutes)</span>
                            <select class="filter-select" style="width: 100px;">
                                <option>15</option>
                                <option selected>30</option>
                                <option>60</option>
                                <option>120</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                        <div class="settings-item">
                            <span>Email Notifications</span>
                            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span>New User Alerts</span>
                            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-globe"></i> Platform Settings</h3>
                        <div class="settings-item">
                            <span>Maintenance Mode</span>
                            <div class="toggle-switch" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span>User Registration</span>
                            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> Data Management</h3>
                        <div class="settings-item">
                            <span>Auto-backup</span>
                            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <button class="btn btn-outline" style="margin-top: 15px; width: 100%;" onclick="alert('Initiating manual backup...')">
                            <i class="fas fa-cloud-upload-alt"></i> Backup Now
                        </button>
                    </div>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 25px;">
                    <button class="btn btn-outline" onclick="alert('Changes discarded!')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ADMIN DASHBOARD - BACKEND INTEGRATION
        // ============================================

        // Current user info - dynamically populated from backend
        const CURRENT_USER = {
            username: {{ user.username|tojson|safe }},
            user_type: {{ user.user_type|tojson|safe }},
            user_id: {% if user._id %}{{ user._id|string|tojson|safe }}{% else %}null{% endif %},
            profile_image: {% if user.profile_image %}{{ user.profile_image|tojson|safe }}{% else %}null{% endif %}
        };

        const API_BASE = '';

        // ========== PROFILE IMAGE UPLOAD WITH RIGHT-CLICK DELETE ==========
        function initProfileImage() {
            const navbarProfileIcon = document.getElementById('navbarProfileIcon');
            const sidebarAvatar = document.getElementById('sidebarAvatar');
            const profileImageUpload = document.getElementById('profileImageUpload');
            const contextMenu = document.getElementById('profileContextMenu');
            const uploadImageOption = document.getElementById('uploadImageOption');
            const removeImageOption = document.getElementById('removeImageOption');
            const viewImageOption = document.getElementById('viewImageOption');
            
            let activeAvatarTarget = null;

            window.showContextMenu = function(event, target) {
                event.preventDefault();
                event.stopPropagation();
                activeAvatarTarget = target;
                contextMenu.style.left = event.pageX + 'px';
                contextMenu.style.top = event.pageY + 'px';
                contextMenu.classList.add('active');
            };

            function hideContextMenu() {
                contextMenu.classList.remove('active');
            }

            async function uploadImage() {
                profileImageUpload.click();
            }

            async function removeImage() {
                if (!confirm('Are you sure you want to delete your profile photo?')) return;
                
                try {
                    const response = await fetch('/admin/delete_profile_image', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        const timestamp = new Date().getTime();
                        const defaultImage = result.default_image + '?t=' + timestamp;
                        const imgHtml = `<img src="${defaultImage}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                        
                        if (activeAvatarTarget === 'navbar') {
                            navbarProfileIcon.innerHTML = imgHtml;
                            navbarProfileIcon.classList.add('has-image');
                        } else if (activeAvatarTarget === 'sidebar') {
                            sidebarAvatar.innerHTML = imgHtml;
                            sidebarAvatar.classList.add('has-image');
                        }
                        alert('Profile image deleted successfully!');
                    }
                } catch (error) {
                    console.error('Error deleting profile image:', error);
                    alert('Error deleting image. Please try again.');
                }
                hideContextMenu();
            }

            function viewImage() {
                let imgElement;
                if (activeAvatarTarget === 'navbar') {
                    imgElement = navbarProfileIcon.querySelector('img');
                } else if (activeAvatarTarget === 'sidebar') {
                    imgElement = sidebarAvatar.querySelector('img');
                }
                
                if (imgElement && !imgElement.src.includes('cdn-icons-png')) {
                    window.open(imgElement.src.split('?')[0], '_blank');
                } else {
                    alert('No profile image to view.');
                }
                hideContextMenu();
            }

            profileImageUpload.addEventListener('change', async function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    if (file.size > 2 * 1024 * 1024) {
                        alert('File size too large! Max size is 2MB.');
                        return;
                    }
                    if (!file.type.match('image.*')) {
                        alert('Please select an image file');
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('profileImage', file);
                    
                    try {
                        const response = await fetch('/admin/upload_profile', {
                            method: 'POST',
                            body: formData
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            const timestamp = new Date().getTime();
                            const newImageUrl = `/static/profile_images/${result.filename}?t=${timestamp}`;
                            const imgHtml = `<img src="${newImageUrl}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                            
                            if (activeAvatarTarget === 'navbar') {
                                navbarProfileIcon.innerHTML = imgHtml;
                                navbarProfileIcon.classList.add('has-image');
                            } else if (activeAvatarTarget === 'sidebar') {
                                sidebarAvatar.innerHTML = imgHtml;
                                sidebarAvatar.classList.add('has-image');
                            }
                            alert('Profile image updated successfully!');
                        }
                    } catch (error) {
                        console.error('Error uploading profile image:', error);
                        alert('Error uploading image.');
                    }
                }
                hideContextMenu();
            });

            if (CURRENT_USER.profile_image) {
                const imageUrl = `/static/profile_images/${CURRENT_USER.profile_image}`;
                const imgHtml = `<img src="${imageUrl}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                navbarProfileIcon.innerHTML = imgHtml;
                sidebarAvatar.innerHTML = imgHtml;
                navbarProfileIcon.classList.add('has-image');
                sidebarAvatar.classList.add('has-image');
            }

            uploadImageOption.addEventListener('click', uploadImage);
            removeImageOption.addEventListener('click', removeImage);
            viewImageOption.addEventListener('click', viewImage);

            window.addEventListener('click', function(event) {
                if (!event.target.closest('.context-menu') && !event.target.closest('.profile-icon') && !event.target.closest('.user-avatar')) {
                    hideContextMenu();
                }
            });
        }

        // ========== LOAD ADMIN STATISTICS ==========
        async function loadAdminStats() {
            try {
                const response = await fetch('/get_admin_stats');
                const data = await response.json();

                if (data.success) {
                    const stats = data.stats;
                    
                    // Update main stat cards
                    document.getElementById('total-users').innerText = stats.total_users || 0;
                    document.getElementById('active-users').innerText = stats.active_users || 0;
                    document.getElementById('pending-items').innerText = (stats.pending_requests || 0) + (stats.pending_verifications || 0);
                    document.getElementById('completed-items').innerText = stats.completed_total || 0;
                    
                    // Update quick stats
                    document.getElementById('total-users-quick').innerText = stats.total_users || 0;
                    document.getElementById('completed-transactions').innerText = stats.completed_total || 0;
                    
                    // Update responsibility cards
                    document.getElementById('pending-verifications').innerText = stats.pending_verifications || 0;
                    document.getElementById('today-registrations').innerText = stats.today_registrations || 0;
                    document.getElementById('total-donors').innerText = stats.total_donors || 0;
                    document.getElementById('total-receivers').innerText = stats.total_receivers || 0;
                    document.getElementById('suspended-users').innerText = stats.suspended_users || 0;
                    document.getElementById('blocked-users').innerText = stats.blocked_users || 0;
                    document.getElementById('total-transactions').innerText = (stats.total_donations || 0) + (stats.total_requests || 0);
                    document.getElementById('active-today').innerText = stats.active_users || 0;
                    
                    // Update quick actions
                    document.getElementById('quick-users-count').innerText = `${stats.total_users || 0} users registered`;
                    document.getElementById('quick-requests-count').innerText = `${stats.pending_requests || 0} requests need review`;
                    document.getElementById('quick-verifications-count').innerText = `${stats.pending_verifications || 0} pending verifications`;
                    document.getElementById('total-users-count').innerText = stats.total_users || 0;
                }
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        // ========== LOAD DONATIONS STATS ==========
        async function loadDonationsStats() {
            try {
                const response = await fetch('/get_all_donations_admin');
                const data = await response.json();

                if (data.success) {
                    const donations = data.donations || [];
                    const counts = data.counts || {};
                    
                    // Calculate additional metrics
                    const totalQuantity = donations.reduce((sum, d) => sum + (d.quantity || 0), 0);
                    const uniqueDonors = new Set(donations.map(d => d.donor_email)).size;
                    const categories = new Set(donations.map(d => d.category)).size;
                    
                    // Expiry calculations
                    const today = new Date();
                    const expired = donations.filter(d => {
                        if (!d.expiry_date) return false;
                        const expiry = new Date(d.expiry_date);
                        return expiry < today;
                    }).length;
                    
                    const expiringSoon = donations.filter(d => {
                        if (!d.expiry_date) return false;
                        const expiry = new Date(d.expiry_date);
                        const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
                        return diffDays >= 0 && diffDays <= 30;
                    }).length;
                    
                    const safe = donations.filter(d => {
                        if (!d.expiry_date) return false;
                        const expiry = new Date(d.expiry_date);
                        const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
                        return diffDays > 90;
                    }).length;
                    
                    // Update donations stats
                    document.getElementById('total-donations').innerText = donations.length || 0;
                    document.getElementById('total-donations-quick').innerText = donations.length || 0;
                    document.getElementById('available-donations').innerText = counts.available || 0;
                    document.getElementById('claimed-donations').innerText = counts.claimed || 0;
                    document.getElementById('completed-donations').innerText = counts.completed || 0;
                    
                    // Update detailed donation info
                    document.getElementById('total-donation-items').innerText = donations.length || 0;
                    document.getElementById('total-quantity-donated').innerText = totalQuantity + ' units';
                    document.getElementById('unique-donors').innerText = uniqueDonors || 0;
                    document.getElementById('medicine-categories').innerText = categories || 0;
                    
                    // Update expiry summary
                    document.getElementById('expired-count').innerText = expired;
                    document.getElementById('expiring-soon-count').innerText = expiringSoon;
                    document.getElementById('safe-count').innerText = safe;
                    
                    // Update donations medicine list
                    const donationsList = document.getElementById('donations-medicine-list');
                    let donationsHtml = '';
                    
                    // Group donations by medicine name
                    const medicineGroups = {};
                    donations.forEach(d => {
                        const medicineName = d.medicine_name;
                        if (!medicineGroups[medicineName]) {
                            medicineGroups[medicineName] = {
                                name: medicineName,
                                totalQuantity: 0,
                                count: 0,
                                donors: new Set()
                            };
                        }
                        medicineGroups[medicineName].totalQuantity += d.quantity || 0;
                        medicineGroups[medicineName].count++;
                        if (d.donor_username) {
                            medicineGroups[medicineName].donors.add(d.donor_username);
                        }
                    });
                    
                    // Sort by quantity (highest first)
                    const sortedMedicines = Object.values(medicineGroups).sort((a, b) => b.totalQuantity - a.totalQuantity);
                    
                    sortedMedicines.slice(0, 10).forEach(medicine => {
                        donationsHtml += `
                            <div class="medicine-item donations-item">
                                <div class="medicine-info">
                                    <span class="medicine-name">${medicine.name}</span>
                                    <span class="medicine-meta">
                                        <i class="fas fa-boxes"></i> ${medicine.count} donation${medicine.count > 1 ? 's' : ''} | 
                                        <i class="fas fa-users"></i> ${medicine.donors.size} donor${medicine.donors.size > 1 ? 's' : ''}
                                    </span>
                                </div>
                                <span class="medicine-quantity donations-quantity">${medicine.totalQuantity} units</span>
                            </div>
                        `;
                    });
                    
                    donationsList.innerHTML = donationsHtml || '<div style="text-align: center; padding: 20px; color: var(--gray);">No donations found</div>';
                }
            } catch (error) {
                console.error('Error loading donations stats:', error);
            }
        }

        // ========== LOAD REQUESTS STATS ==========
        async function loadRequestsStats() {
            try {
                const response = await fetch('/get_all_requests_admin');
                const data = await response.json();

                if (data.success) {
                    const requests = data.requests || [];
                    const counts = data.counts || {};
                    
                    // Calculate additional metrics
                    const totalQuantity = requests.reduce((sum, r) => sum + (r.quantity || 0), 0);
                    const uniqueReceivers = new Set(requests.map(r => r.receiver_email)).size;
                    const fulfillmentRate = counts.total > 0 ? Math.round((counts.completed / counts.total) * 100) : 0;
                    
                    // Urgency counts
                    const immediate = requests.filter(r => r.urgency === 'immediate').length;
                    const urgent = requests.filter(r => r.urgency === 'urgent').length;
                    const normal = requests.filter(r => r.urgency === 'normal').length;
                    const low = requests.filter(r => r.urgency === 'low').length;
                    
                    // Update requests stats
                    document.getElementById('total-requests').innerText = requests.length || 0;
                    document.getElementById('total-requests-quick').innerText = requests.length || 0;
                    document.getElementById('pending-requests-total').innerText = counts.pending || 0;
                    document.getElementById('approved-requests-total').innerText = counts.approved || 0;
                    document.getElementById('completed-requests-total').innerText = counts.completed || 0;
                    
                    // Update detailed request info
                    document.getElementById('total-requests-count').innerText = requests.length || 0;
                    document.getElementById('total-quantity-requested').innerText = totalQuantity + ' units';
                    document.getElementById('unique-receivers').innerText = uniqueReceivers || 0;
                    document.getElementById('fulfillment-rate').innerText = fulfillmentRate + '%';
                    
                    // Update urgency breakdown
                    document.getElementById('immediate-count').innerText = immediate;
                    document.getElementById('urgent-count').innerText = urgent;
                    document.getElementById('normal-count').innerText = normal;
                    document.getElementById('low-count').innerText = low;
                    
                    // Update requests medicine list
                    const requestsList = document.getElementById('requests-medicine-list');
                    let requestsHtml = '';
                    
                    // Group requests by medicine name
                    const medicineGroups = {};
                    requests.forEach(r => {
                        const medicineName = r.medicine_name;
                        if (!medicineGroups[medicineName]) {
                            medicineGroups[medicineName] = {
                                name: medicineName,
                                totalQuantity: 0,
                                count: 0,
                                pendingCount: 0,
                                urgentCount: 0
                            };
                        }
                        medicineGroups[medicineName].totalQuantity += r.quantity || 0;
                        medicineGroups[medicineName].count++;
                        if (r.status === 'pending') {
                            medicineGroups[medicineName].pendingCount++;
                        }
                        if (r.urgency === 'immediate' || r.urgency === 'urgent') {
                            medicineGroups[medicineName].urgentCount++;
                        }
                    });
                    
                    // Sort by quantity (highest first)
                    const sortedMedicines = Object.values(medicineGroups).sort((a, b) => b.totalQuantity - a.totalQuantity);
                    
                    sortedMedicines.slice(0, 10).forEach(medicine => {
                        const urgentBadge = medicine.urgentCount > 0 ? 
                            `<span class="badge-stat urgent" style="margin-left: 5px; font-size: 10px;">${medicine.urgentCount} urgent</span>` : '';
                        
                        requestsHtml += `
                            <div class="medicine-item requests-item">
                                <div class="medicine-info">
                                    <span class="medicine-name">${medicine.name} ${urgentBadge}</span>
                                    <span class="medicine-meta">
                                        <i class="fas fa-clipboard-list"></i> ${medicine.count} request${medicine.count > 1 ? 's' : ''} | 
                                        <i class="fas fa-hourglass-half"></i> ${medicine.pendingCount} pending
                                    </span>
                                </div>
                                <span class="medicine-quantity requests-quantity">${medicine.totalQuantity} units</span>
                            </div>
                        `;
                    });
                    
                    requestsList.innerHTML = requestsHtml || '<div style="text-align: center; padding: 20px; color: var(--gray);">No requests found</div>';
                }
            } catch (error) {
                console.error('Error loading requests stats:', error);
            }
        }

        // ========== LOAD ALL USERS ==========
        async function loadAllUsers(page = 1) {
            const tbody = document.getElementById('users-table-body');
            if (!tbody) return;

            try {
                const response = await fetch('/get_all_users');
                const data = await response.json();

                if (data.success) {
                    const users = data.users || [];
                    const start = (page - 1) * 10;
                    const end = start + 10;
                    const pageUsers = users.slice(start, end);
                    
                    let html = '';
                    pageUsers.forEach(user => {
                        const createdDate = user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A';
                        const initials = user.username ? user.username.substring(0, 2).toUpperCase() : 'U';
                        const statusClass = user.status || 'active';
                        const roleClass = user.user_type;
                        
                        html += `
                            <tr>
                                <td>
                                    <div class="user-cell">
                                        <div class="user-avatar-table">${initials}</div>
                                        <div class="user-info-table">
                                            <span class="user-name-table">${user.username}</span>
                                            <span class="user-email-table">${user.email}</span>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="role-badge ${roleClass}">${user.user_type}</span></td>
                                <td>${createdDate}</td>
                                <td><span class="status-badge ${statusClass}">${user.status || 'active'}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="icon-btn view" onclick="viewUserDetails('${user.id}', '${user.user_type}')" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="icon-btn edit" onclick="editUser('${user.id}', '${user.user_type}')" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        ${!user.verified && user.user_type !== 'admin' ? `
                                        <button class="icon-btn verify" onclick="verifyUser('${user.id}', '${user.user_type}')" title="Verify">
                                            <i class="fas fa-check-circle"></i>
                                        </button>
                                        ` : ''}
                                        ${user.status === 'active' ? `
                                        <button class="icon-btn suspend" onclick="suspendUser('${user.id}', '${user.user_type}')" title="Suspend">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                        ` : `
                                        <button class="icon-btn verify" onclick="activateUser('${user.id}', '${user.user_type}')" title="Activate">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        `}
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                    
                    tbody.innerHTML = html || '<tr><td colspan="5" style="text-align: center; padding: 40px;">No users found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // ========== LOAD MEDICINE REQUESTS ==========
        async function loadMedicineRequests(filter = 'all') {
            const requestsGrid = document.getElementById('requests-grid');
            const tbody = document.getElementById('requests-table-body');
            
            try {
                const response = await fetch('/get_all_requests_admin');
                const data = await response.json();

                if (data.success) {
                    let requests = data.requests || [];
                    
                    // Apply filter
                    if (filter !== 'all') {
                        requests = requests.filter(r => r.status === filter);
                    }
                    
                    // Update request cards (first 3)
                    let cardsHtml = '';
                    requests.slice(0, 3).forEach(request => {
                        cardsHtml += `
                            <div class="request-card">
                                <div class="request-header">
                                    <span class="request-medicine">${request.medicine_name}</span>
                                    <span class="request-status ${request.status}">${request.status}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--gray);">${request.dosage || ''}</span>
                                    <span style="font-weight: 600; color: var(--purple);">Qty: ${request.quantity}</span>
                                </div>
                                <div class="request-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Requester:</span>
                                        <span class="detail-value">${request.receiver_username}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Location:</span>
                                        <span class="detail-value">${request.preferred_location || 'Not specified'}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Urgency:</span>
                                        <span class="detail-value" style="color: var(--${request.urgency_color});">${request.urgency}</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    ${request.status === 'pending' ? `
                                    <button class="btn btn-primary" style="flex: 1; padding: 10px;" onclick="updateRequestStatus('${request.id}', 'approved')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn btn-outline" style="flex: 1; padding: 10px;" onclick="updateRequestStatus('${request.id}', 'rejected')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                    ` : `
                                    <button class="btn btn-primary" style="flex: 1; padding: 10px;" onclick="viewRequestDetails('${request.id}')">
                                        <i class="fas fa-eye"></i> View Details
                                    </button>
                                    `}
                                </div>
                            </div>
                        `;
                    });
                    requestsGrid.innerHTML = cardsHtml || '<div style="grid-column: 1/-1; text-align: center; padding: 40px;">No requests found</div>';
                    
                    // Update table
                    let tableHtml = '';
                    requests.slice(0, 5).forEach(request => {
                        tableHtml += `
                            <tr>
                                <td>${request.medicine_name} ${request.dosage || ''}</td>
                                <td>${request.receiver_username}</td>
                                <td>${request.quantity} units</td>
                                <td>${request.preferred_location || 'N/A'}</td>
                                <td><span style="color: var(--${request.urgency_color});">${request.urgency}</span></td>
                                <td><span class="status-badge ${request.status}">${request.status}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="icon-btn view" onclick="viewRequestDetails('${request.id}')" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        ${request.status === 'pending' ? `
                                        <button class="icon-btn verify" onclick="updateRequestStatus('${request.id}', 'approved')" title="Approve">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="icon-btn suspend" onclick="updateRequestStatus('${request.id}', 'rejected')" title="Reject">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        ` : ''}
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                    tbody.innerHTML = tableHtml || '<tr><td colspan="7" style="text-align: center; padding: 40px;">No requests found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading medicine requests:', error);
            }
        }

        // ========== LOAD DONATIONS ==========
        async function loadDonations(filter = 'all') {
            const donationsGrid = document.getElementById('donations-grid');
            
            try {
                const response = await fetch('/get_all_donations_admin');
                const data = await response.json();

                if (data.success) {
                    let donations = data.donations || [];
                    
                    // Apply filter
                    if (filter !== 'all') {
                        donations = donations.filter(d => d.status === filter);
                    }
                    
                    let html = '';
                    donations.slice(0, 6).forEach(donation => {
                        const initials = donation.donor_username ? donation.donor_username.substring(0, 2).toUpperCase() : 'D';
                        html += `
                            <div class="donation-card">
                                <div class="donation-header">
                                    <div class="donor-avatar">${initials}</div>
                                    <div class="donor-info">
                                        <h4>${donation.donor_username}</h4>
                                        <p>Donor</p>
                                    </div>
                                    <span class="badge badge-available" style="margin-left: auto;">${donation.status}</span>
                                </div>
                                <h3 style="font-size: 18px; margin-bottom: 10px;">${donation.medicine_name}</h3>
                                <p style="color: var(--gray); margin-bottom: 15px;">${donation.manufacturer || ''}  Exp: ${donation.expiry_date}</p>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                    <span><i class="fas fa-box"></i> Qty: ${donation.quantity} units</span>
                                    <span style="font-weight: 600; color: var(--purple);">${donation.time_ago}</span>
                                </div>
                                <button class="btn btn-primary" style="width: 100%;" onclick="viewDonationDetails('${donation.id}')">
                                    <i class="fas fa-eye"></i> View Details
                                </button>
                            </div>
                        `;
                    });
                    donationsGrid.innerHTML = html || '<div style="grid-column: 1/-1; text-align: center; padding: 40px;">No donations found</div>';
                }
            } catch (error) {
                console.error('Error loading donations:', error);
            }
        }

        // ========== USER MANAGEMENT ACTIONS ==========
        window.viewUserDetails = function(userId, userType) {
            alert(`Viewing details for user: ${userId}\nUser Type: ${userType}`);
        };

        window.editUser = function(userId, userType) {
            alert(`Editing user: ${userId}\nUser Type: ${userType}`);
        };

        window.verifyUser = async function(userId, userType) {
            if (!confirm(`Are you sure you want to verify this ${userType}?`)) return;
            
            try {
                const response = await fetch('/verify_user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, user_type: userType })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(' User verified successfully!');
                    loadAllUsers();
                    loadAdminStats();
                }
            } catch (error) {
                console.error('Error verifying user:', error);
            }
        };

        window.suspendUser = async function(userId, userType) {
            if (!confirm(`Are you sure you want to suspend this ${userType}?`)) return;
            
            try {
                const response = await fetch('/update_user_status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, user_type: userType, status: 'suspended' })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(' User suspended successfully!');
                    loadAllUsers();
                    loadAdminStats();
                }
            } catch (error) {
                console.error('Error suspending user:', error);
            }
        };

        window.activateUser = async function(userId, userType) {
            if (!confirm(`Are you sure you want to activate this ${userType}?`)) return;
            
            try {
                const response = await fetch('/update_user_status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, user_type: userType, status: 'active' })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(' User activated successfully!');
                    loadAllUsers();
                    loadAdminStats();
                }
            } catch (error) {
                console.error('Error activating user:', error);
            }
        };

        // ========== REQUEST MANAGEMENT ACTIONS ==========
        window.updateRequestStatus = async function(requestId, status) {
            const action = status === 'approved' ? 'approve' : 'reject';
            if (!confirm(`Are you sure you want to ${action} this request?`)) return;
            
            try {
                const response = await fetch('/update_request_status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ request_id: requestId, status: status })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(` Request ${status} successfully!`);
                    loadMedicineRequests(document.getElementById('request-status-filter')?.value || 'all');
                    loadAdminStats();
                    loadRequestsStats();
                }
            } catch (error) {
                console.error(`Error ${action}ing request:`, error);
            }
        };

        window.viewRequestDetails = function(requestId) {
            alert(`Viewing details for request: ${requestId}`);
        };

        window.viewDonationDetails = function(donationId) {
            alert(`Viewing details for donation: ${donationId}`);
        };

        // ========== FILTER HANDLERS ==========
        function initFilters() {
            const requestFilter = document.getElementById('request-status-filter');
            if (requestFilter) {
                requestFilter.addEventListener('change', function() {
                    loadMedicineRequests(this.value);
                });
            }

            const donationFilter = document.getElementById('donation-status-filter');
            if (donationFilter) {
                donationFilter.addEventListener('change', function() {
                    loadDonations(this.value);
                });
            }

            const userSearch = document.getElementById('userSearch');
            if (userSearch) {
                userSearch.addEventListener('input', function(e) {
                    // Implement search functionality
                    console.log('Searching:', e.target.value);
                });
            }

            const roleFilter = document.getElementById('roleFilter');
            const statusFilter = document.getElementById('statusFilter');
            
            [roleFilter, statusFilter].forEach(filter => {
                if (filter) {
                    filter.addEventListener('change', function() {
                        loadAllUsers(1);
                    });
                }
            });
        }

        // ========== NAVIGATION ==========
        window.navigateTo = function(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');
            
            document.querySelectorAll('.sidebar-menu a').forEach(link => link.classList.remove('active'));
            document.getElementById(`sidebar-${page}`)?.classList.add('active');
            
            // Load page-specific data
            if (page === 'medicine-requests') loadMedicineRequests('all');
            if (page === 'donations') loadDonations('all');
            if (page === 'user-management') loadAllUsers(1);
        };

        window.toggleDropdown = function() {
            document.getElementById('profileMenu').classList.toggle('active');
        };

        window.securityCheck = function() {
            alert(' Security Check Results:\n\n Firewall Status: Active\n Database Security: Secure\n SSL Certificate: Valid\n No security issues detected.');
        };

        window.generateReport = function(type) {
            alert(`Generating ${type} report...`);
        };

        window.saveSettings = function() {
            alert('Settings saved successfully!');
        };

        window.filterVerifications = function(type) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            alert(`Filtering ${type} verifications...`);
        };

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-datetime').innerText = now.toLocaleDateString('en-US', options);
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            initProfileImage();
            updateDateTime();
            loadAdminStats();
            loadDonationsStats();
            loadRequestsStats();
            loadAllUsers(1);
            loadMedicineRequests('all');
            loadDonations('all');
            initFilters();
            
            // Update user info
            document.querySelectorAll('.dropdown-header, .user-name').forEach(el => {
                if (el) el.innerText = CURRENT_USER.username;
            });
            
            // Set default page
            navigateTo('dashboard');
            
            console.log(' Admin Dashboard initialized with complete donation and request information');
            console.log('Total Donations:', document.getElementById('total-donations').innerText);
            console.log('Total Requests:', document.getElementById('total-requests').innerText);
        });

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.profile-icon') && !event.target.closest('.profile-icon')) {
                const dropdown = document.getElementById('profileMenu');
                if (dropdown?.classList.contains('active')) {
                    dropdown.classList.remove('active');
                }
            }
        };
    </script>
</body>
</html>